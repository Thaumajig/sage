<% if notice %>
  <div id="notice" class="alert alert-success"><%= notice %></div>
<% end %>

<div class="row nodecoration">
  <div class="col-md-6">
    <div class="text-center well">
      <% if @digital_object.has_uri? %>
        <%= link_to @digital_object.location do%>
          <%= image_tag thumbnail_url(@digital_object.thumbnail(400,400)), style: "width: 100%", id: "thumbnail" %><br>
          <div class="truncate"><%= File.basename(@digital_object.location) %></div>
        <% end %>
      <% else %>
        <%= image_tag thumbnail_url(@digital_object.thumbnail(400,400)), style: "width: 100%" %><br>
        <div class="truncate"><%= File.basename(@digital_object.location) %></div>
      <% end %>

      <%= link_to "#", title: "Flip Image", onclick: "$('#thumbnail').toggleClass('flipped')" do %>
        <i class="glyphicon glyphicon-resize-horizontal"></i>
      <% end %>
      <%= link_to repair_thumbnails_project_digital_object_path(@project, @digital_object), title: "Repair Thumbnails", method: :post do %>
        <i class="glyphicon glyphicon-refresh"></i>
      <% end %>
      <%= link_to edit_project_digital_object_path(@project, @digital_object), title: "Edit" do %>
        <i class="glyphicon glyphicon-pencil"></i>
      <% end %>
      <%= link_to project_digital_object_path(@project, @digital_object), title: "Delete", method: :delete, data: { confirm: 'Are you sure?' } do %>
        <i class="glyphicon glyphicon-trash"></i>
      <% end %>
    </div>
  </div>

  <div class="col-md-6">
    <h1>Concept Associations</h1>

    <%= form_for @concept, url: {action: "add_created_concept"}, html: {class: "form-inline"} do |f| %>
      <div class="input-group", style="width: 100%">
        <%= f.text_field :description, class: "form-control", autofocus: true %>
        <span class="input-group-btn">
          <%= f.submit "Add", class: "btn btn-primary", style: "width: 100%" %>
        </span>
      </div>
    <% end %>

    <br>

    <table class="table table-hover">
      <% relevant = @digital_object.relevant %>
      <% relevant.keys.each do |concept| %>
      <tr>

        <td>
          <%= link_to truncate(concept.description, length: 50), [@project, concept] %>

          <% if !@digital_object.concepts.include? concept %>
            <%= link_to add_concept_project_digital_object_path(@project, @digital_object, concept_id: concept.id), method: :post, title: "Add" do %>
              <div class="btn btn-default pull-right">
                <%= relevant[concept].round(2) %> <i class="glyphicon glyphicon-unchecked"></i>
              </div>
            <% end %>
          <% else %>
            <%= link_to remove_concept_project_digital_object_path(@project, @digital_object, concept_id: concept.id), method: :post, title: "Remove" do %>
              <div class="btn btn-primary pull-right">
                <%= relevant[concept].round(2) %> <i class="glyphicon glyphicon-check"></i>
              </div>
            <% end %>
          <% end %>
        </td>

      </tr>
      <% end %>
    </table>
  </div>
</div>
